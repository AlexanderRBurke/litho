<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.8">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-28","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Litho" href="/opensearch.xml"><title data-react-helmet="true">State Overview | Litho</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/state-overview/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="State Overview | Litho"><meta data-react-helmet="true" name="description" content="This page was moved from the old website without any change and might be updated"><meta data-react-helmet="true" property="og:description" content="This page was moved from the old website without any change and might be updated"><link data-react-helmet="true" rel="shortcut icon" href="/images/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/state-overview/"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/state-overview/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://fblitho.com/docs/mainconcepts/coordinate-state-actions/state-overview/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3f64508b.css">
<link rel="preload" href="/assets/js/runtime~main.64fa497a.js" as="script">
<link rel="preload" href="/assets/js/main.95f71369.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/images/logo.svg" alt="Litho Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">Litho</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/intro/motivation/">Docs</a><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a class="navbar__item navbar__link" href="/docs/tutorial/overview/">Tutorial</a><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">What is Litho?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Tutorial</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Main Concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">UI Composition</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Passing Data To Components</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Coordinating State and Actions</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/state-overview/">State Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/hoisting-state/">Hoisting State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/events/">Events Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/communicating-between-components/">Communicating Between Components</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/trigger-events/">Triggering events with Handles</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/componenttree/">ComponentTree</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/mainconcepts/coordinate-state-actions/visibility-handling/">Visibility Handling</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Building lists</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Widgets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Debugging</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Developer Tools</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Animations</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Accessibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Performance</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Best Practices</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Deep Dive</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">State Overview</h1></header><div class="markdown"><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Content will be updated</h5></div><div class="admonition-content"><p>This page was moved from the old website without any change and might be updated</p></div></div><p>A Litho component can contain two types of data:</p><ul><li><strong>props</strong>: passed down from parent and cannot change during a component&#x27;s lifecycle.</li><li><strong>state</strong>: encapsulated and managed within the component, and is transparent to the parent.</li></ul><p>States for a given Component are the union of all arguments annotated with
<a href="/javadoc/com/facebook/litho/annotations/State.html" target="_blank" rel="noopener noreferrer">State</a> in the spec. While both Prop and
State hold information that influences the output of the component, they are different in one
important way: props get passed to the component from its parent whereas states are managed
within the component.</p><p>The initial values of states can be set using the
<a href="/javadoc/com/facebook/litho/annotations/OnCreateInitialState.html" target="_blank" rel="noopener noreferrer">OnCreateInitialState</a> method
and states can be updated in <a href="/javadoc/com/facebook/litho/annotations/OnUpdateState.html" target="_blank" rel="noopener noreferrer">OnUpdateState</a>
methods. Updating states in the <a href="/javadoc/com/facebook/litho/annotations/OnUpdateState.html" target="_blank" rel="noopener noreferrer">OnUpdateState</a>
methods will cause the component to invoke its
<a href="/javadoc/com/facebook/litho/annotations/OnCreateLayout.html" target="_blank" rel="noopener noreferrer">OnCreateLayout</a> method.
States should be immutable since the layout can be calculated on multiple threads. Immutability of
the states ensures that no thread safety issues can occur in the component hierarchy.</p><p>A common example of State usage is rendering a checkbox. The component renders different
drawables for the checked and unchecked states, but this is an internal detail of the checkbox
component that the parent doesn&#x27;t need to be aware of.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="declaring-a-component-state">Declaring a Component State<a aria-hidden="true" class="hash-link" href="#declaring-a-component-state" title="Direct link to heading">​</a></h2><p>You can define a State on a Component by using the @State annotation in the spec lifecycle methods, similarly to how you would define a Prop.</p><p>Defining state elements is enabled on the lifecycle methods of Layout Specs and Mount Specs.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CheckboxSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @State boolean isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Image.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .drawableRes(isChecked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ? R.drawable.is_checked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                : R.drawable.is_unchecked))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Text.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .text(&quot;Submit&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .clickHandler(Checkbox.onClickedText(c)))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onClickedText(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @State boolean isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="initializing-a-state-value">Initializing a State value<a aria-hidden="true" class="hash-link" href="#initializing-a-state-value" title="Direct link to heading">​</a></h2><p>To set an initial value for a state, you have to write a method annotated with <code>@OnCreateInitialState</code> in your spec.</p><p>This is what you need to know when writing an <code>@OnCreateInitialState</code> method:</p><ul><li>The first parameter must be of type <code>ComponentContext</code>.</li><li><code>@Prop</code> parameters are allowed.</li><li>All other parameters must have a corresponding parameter annotated with <code>@State</code> in the other lifecycle methods, and their type must be a <a href="/javadoc/com/facebook/litho/StateValue.html" target="_blank" rel="noopener noreferrer">StateValue</a> that is parameterized with the type of the matching <code>@State</code> element.</li><li><code>@OnCreateInitialState</code> methods are not mandatory. If you do not define one or if you only initialize some states, the uninitialized ones will take Java defaults.</li><li><code>@OnCreateInitialState</code> is called only once for each component, when it first gets added to the <code>ComponentTree</code>. Following layout recalculations of the same <code>ComponentTree</code> will not call this again if the key of the component doesn&#x27;t change.</li><li>You should never need to call the <code>@OnCreateInitialState</code> method yourself.</li></ul><p>Here&#x27;s how you would initialize the checkbox state with a value passed down from the parent:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CheckboxSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateInitialState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onCreateInitialState(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      StateValue&lt;Boolean&gt; isChecked,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Prop boolean initChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isChecked.set(initChecked);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="defining-state-updates">Defining State Updates<a aria-hidden="true" class="hash-link" href="#defining-state-updates" title="Direct link to heading">​</a></h2><p>You can define how a component&#x27;s state or states should be updated by declaring methods annotated with <code>@OnUpdateState</code> in the specs.</p><p>You can have as many <code>@OnUpdateState</code> methods as you need, according to what states you want to update or what parameters your states depend on.</p><p>Each call to an <code>@OnUpdateState</code> method will trigger a new layout calculation for its ComponentTree. For better performance, if there are situations that can trigger an update for multiple states, you should define an <code>@OnUpdateState</code> method that updates the value for all those states. Bundling them in the same update call reduces the number of new layout calculations and improves performance.</p><p>This is what you need to know when writing an <code>@OnUpdateState</code>  method:</p><ul><li>Parameters representing the states must match the name of a parameter annotated with <code>@State</code> and their type must be a <code>StateValue</code> parameterized with the type of the matching <code>@State</code>.</li><li><code>@Param</code> parameters are allowed. If the value of your state depends on props, you can declare them like this and pass the value of the prop when the update call is triggered.</li><li>All other parameters must have a corresponding parameter annotated with <code>@State</code> in the other lifecycle methods, and their type must be a <code>StateValue</code> parameterized with the type of the matching <code>@State</code> element.</li></ul><p>Here&#x27;s how you would define a state update method for the checkbox:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CheckboxSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void updateCheckboxState(StateValue&lt;Boolean&gt; isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isChecked.set(!isChecked.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you want to bundle multiple state updates in a single method, you would just add all those states as parameters to the same <code>@OnUpdateState</code> method:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void updateMultipleStates(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateValue&lt;Boolean&gt; stateOne,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateValue&lt;String&gt; stateTwo,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Param int someParam) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  final boolean thresholdReached = someParam &gt; 100;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stateOne.set(thresholdReached);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stateTwo.set(thresholdReached ? &quot;reached&quot; : &quot;not reached&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="calling-state-updates">Calling state updates<a aria-hidden="true" class="hash-link" href="#calling-state-updates" title="Direct link to heading">​</a></h2><p>For each <code>@OnUpdateState</code> method in your spec, the generated component will have two methods that will delegate to the <code>@OnUpdateState</code> method under the hood:</p><ul><li>a static method with the same name, which will asynchronously apply the state updates.</li><li>a static method with the same name and a <em>Sync</em> suffix, which will synchronously trigger the state updates.
Both methods take a <code>ComponentContext</code> as first parameter, followed by all the parameters declared with <code>@Param</code> in your <code>@OnUpdateState</code> method.</li></ul><p>Here&#x27;s how you would call the state update method to update your checkbox when a user clicks it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@LayoutSpec</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class CheckboxSpec {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static Component onCreateLayout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      @State boolean isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .child(Image.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            .drawableRes(isChecked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ? R.drawable.is_checked</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                : R.drawable.is_unchecked))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clickHandler(Checkbox.onCheckboxClicked(c))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnUpdateState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void updateCheckbox(StateValue&lt;Boolean&gt; isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    isChecked.set(!isChecked.get());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  @OnEvent(ClickEvent.class)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void onCheckboxClicked(ComponentContext c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Checkbox.updateCheckbox(c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Checkbox.updateCheckboxSync(c); for a sync update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is what you need to keep in mind when calling state update methods:</p><ul><li>When calling a state update method, the <code>ComponentContext</code> instance passed as first parameter must always be the one that is passed down as parameter in the lifecycle method in which the update state is triggered. This context contains important information about the currently known state values and it&#x27;s important for transferring these values from the old components to the new ones during new layout calculations.</li><li>In <code>LayoutSpec</code>s, you should avoid calling state update methods in <code>onCreateLayout</code>, unless you are absolutely certain they will happen only a deterministic, small number of times.
Every call to a state update method will trigger a new layout calculation on the ComponentTree, which in turn will call <code>onCreateLayout</code> on all its components, so it&#x27;s rather easy to go into an infinite loop. You should consider whether a lazy state update (described below) wouldn&#x27;t be more appropriate for your use case.</li><li>In <code>MountSpec</code>s, you should never call update state methods from <code>bind</code> and <code>mount</code> methods. If you need to update a state value in those methods, you should instead use a lazy state update, described below.</li><li>State is a concept local to components. You cannot call a state update method from outside a component. <a href="/docs/mainconcepts/passing-data-to-components/props/">Props</a> are the mechanism to update a component based on outside changes. You can read more about that <a href="/docs/best-practices/props-vs-state/">here</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_31ik" id="keys-and-identifying-components">Keys and identifying components<a aria-hidden="true" class="hash-link" href="#keys-and-identifying-components" title="Direct link to heading">​</a></h2><p>The framework sets a key on each component, based on its type and the key of its parent. This key is used to determine which component we want to update when calling a state update and finding this component when traversing the tree.</p><p>Components of the same type that have the same parent will be assigned the same key, so we need a way of uniquely identifying them.</p><p>Moreover, when a Component&#x27;s state or props are updated and the <code>ComponentTree</code> is recreated, there are situations when components are removed, added or rearranged inside the tree. Because components can be dynamic we need a way of keeping track of the components so we know, even after the <code>ComponentTree</code> changes, for which component to apply a state update.</p><p>Whenever a key collision is detected in a ComponentTree, which can happen when a parent component created multiple children components of the same type, we assign a unique key on those siblings which depends on the order in which they added to the parent.
However, with the current implementation, there&#x27;s no easy way for us to detect that a component is the same when the order of the components in your hierarchy changes. This means that the keys that are autogenerated are not stable through component moves. If you expect your components to move around, you have to assign manual keys.</p><p>The <code>Component.Builder</code> class exposes a <code>.key()</code> method that you can call when creating a component to assign a unique key to it that will be used to identify this component.</p><p>You should set this key whenever you have multiple children of the same component with the same type or you expect the content of your layout to be dynamic.
The manual key you set on a component using the <code>key</code> prop will always take precedence over the autogenerated one.</p><p>The most common case when you must manually define keys for your components is creating and adding them as children in a loop:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static Component onCreateLayout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @State boolean isChecked) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  final Component.Builder parent = Column.create(c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (int i = 0; i &lt; 10; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    parent.child(Text.create(c).key(&quot;key&quot; +i));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return parent.build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If a component with key <code>A</code> updates its state, and later it is removed from the hierarchy and added back again with the same key <code>A</code>, its state will be reset to the initial value. That means that an updated state value will only persist as long as the component it belongs to is part of the ComponentTree hierarchy.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="lazy-state-updates">Lazy State Updates<a aria-hidden="true" class="hash-link" href="#lazy-state-updates" title="Direct link to heading">​</a></h2><p>For situations where you want to update the value of a <code>State</code>, but don&#x27;t need to immediately trigger a new layout calculation, you can use <strong>lazy state updates</strong>. After a lazy state update, the new state value will be visible in event handlers, but a new layout will not be triggered. Currently, the value is <strong>not</strong> visible to other lifecycle callbacks (e.g. <code>onMount</code>).</p><p>This is useful for updating state that doesn&#x27;t need to be reflected in the UI. For example, say you want to log an analytics event only the first time a Component becomes visible. If you use lazy state, you can record whether a log was sent in a lazy <code>@State</code> variable without causing the UI to reflow.</p><p>To use lazy state updates, you need to set the <code>canUpdateLazily</code> parameter on the <code>@State</code> annotation to <code>true</code>.</p><p>For a state parameter <code>foo</code> marked with <code>canUpdateLazily</code>, the framework will generate a static state update method named <code>lazyUpdateFoo</code> which takes a new value as parameter that will be set as the new value for <code>foo</code>.</p><p>States marked as <code>canUpdateLazily</code> can still be used for regular state updates.</p><p>Let&#x27;s look at an example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateLayout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static Component onCreateLayout(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    final ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @State(canUpdateLazily = true) String foo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FooComponent.lazyUpdateFoo(c, &quot;updated foo&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return Column.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .child(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          Text.create(c)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              .text(foo))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@OnCreateInitialState</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void onCreateInitialState(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ComponentContext c,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    StateValue&lt;String&gt; foo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  foo.set(&quot;first foo&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The first time FooComponent is rendered, its child <code>Text</code> component will display <em>&quot;first foo&quot;</em>, even if <code>foo</code> is lazily updated with another value. When a regular state update or receiving new props will trigger a new layout calculation, the lazy state update will be applied and the <code>Text</code> will render <em>&quot;updated foo&quot;</em>.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="immutability">Immutability<a aria-hidden="true" class="hash-link" href="#immutability" title="Direct link to heading">​</a></h2><p>Because of <a href="/docs/asynchronous-layout/">background layout</a>, <code>State</code> can be accessed at anytime by multiple threads. To ensure thread safety, <code>State</code> objects should be immutable (and if for some rare reason this is not possible, then at least thread safe). The simplest solution is to express your state in terms of primitives since primitives are by definition immutable.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/litho/edit/master/website/../docs/mainconcepts/coordinate-state-actions/state-overview.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/mainconcepts/passing-data-to-components/treeprops/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« <!-- -->TreeProps</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/mainconcepts/coordinate-state-actions/hoisting-state/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Hoisting State<!-- --> »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#declaring-a-component-state" class="table-of-contents__link toc-highlight">Declaring a Component State</a></li><li><a href="#initializing-a-state-value" class="table-of-contents__link toc-highlight">Initializing a State value</a></li><li><a href="#defining-state-updates" class="table-of-contents__link toc-highlight">Defining State Updates</a></li><li><a href="#calling-state-updates" class="table-of-contents__link toc-highlight">Calling state updates</a></li><li><a href="#keys-and-identifying-components" class="table-of-contents__link toc-highlight">Keys and identifying components</a></li><li><a href="#lazy-state-updates" class="table-of-contents__link toc-highlight">Lazy State Updates</a></li><li><a href="#immutability" class="table-of-contents__link toc-highlight">Immutability</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/">Getting Started</a></li><li class="footer__item"><a href="/javadoc" target="_blank" rel="noopener noreferrer" class="footer__link-item">API</a></li></ul></div><div class="col footer__col"><div class="footer__title">Open Source</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/contributing/">How To Contribute</a></li><li class="footer__item"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Open Source Projects<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebook/litho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/fblitho" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/images/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Facebook, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.64fa497a.js"></script>
<script src="/assets/js/main.95f71369.js"></script>
</body>
</html>