"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9088],{3905:(e,n,t)=>{t.r(n),t.d(n,{MDXContext:()=>m,MDXProvider:()=>c,mdx:()=>f,useMDXComponents:()=>p,withMDXComponents:()=>d});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(){return o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},o.apply(this,arguments)}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var m=a.createContext({}),d=function(e){return function(n){var t=p(n.components);return a.createElement(e,o({},n,{components:t}))}},p=function(e){var n=a.useContext(m),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(m.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,r=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=p(t),c=i,h=d["".concat(r,".").concat(c)]||d[c]||u[c]||o;return t?a.createElement(h,s(s({ref:n},m),{},{components:t})):a.createElement(h,s({ref:n},m))}));function f(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var m=2;m<o;m++)r[m]=t[m];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},13919:(e,n,t)=>{function a(e){return!0===/^(\w*:|\/\/)/.test(e)}function i(e){return void 0!==e&&!a(e)}t.d(n,{b:()=>a,Z:()=>i})},44996:(e,n,t)=>{t.r(n),t.d(n,{useBaseUrlUtils:()=>o,default:()=>r});var a=t(52263),i=t(13919);function o(){var e=(0,a.default)().siteConfig,n=(e=void 0===e?{}:e).baseUrl,t=void 0===n?"/":n,o=e.url;return{withBaseUrl:function(e,n){return function(e,n,t,a){var o=void 0===a?{}:a,r=o.forcePrependBaseUrl,s=void 0!==r&&r,l=o.absolute,m=void 0!==l&&l;if(!t)return t;if(t.startsWith("#"))return t;if((0,i.b)(t))return t;if(s)return n+t;var d=t.startsWith(n)?t:n+t.replace(/^\//,"");return m?e+d:d}(o,t,e,n)}}}function r(e,n){return void 0===n&&(n={}),(0,o().withBaseUrl)(e,n)}},60656:(e,n,t)=>{t.r(n),t.d(n,{frontMatter:()=>l,contentTitle:()=>m,metadata:()=>d,toc:()=>p,default:()=>u});var a=t(87462),i=t(63366),o=(t(67294),t(3905)),r=t(44996),s=["components"],l={id:"transition-basics",title:"Animation basics"},m=void 0,d={unversionedId:"animations/transition-basics",id:"animations/transition-basics",isDocsHomePage:!1,title:"Animation basics",description:"Introduction",source:"@site/../docs/animations/transition-basics.mdx",sourceDirName:"animations",slug:"/animations/transition-basics",permalink:"/docs/animations/transition-basics",editUrl:"https://github.com/facebook/litho/edit/master/website/../docs/animations/transition-basics.mdx",tags:[],version:"current",frontMatter:{id:"transition-basics",title:"Animation basics"},sidebar:"mainSidebar",previous:{title:"Testing in Android Studio",permalink:"/docs/testing/tests-in-android-studio"},next:{title:"Types of Transitions",permalink:"/docs/animations/transition-types"}},p=[{value:"Introduction",id:"introduction",children:[{value:"Bounds Transitions",id:"bounds-transitions",children:[],level:3},{value:"Transitions",id:"transitions",children:[],level:3}],level:2}],c={toc:p};function u(e){var n=e.components,t=(0,i.Z)(e,s);return(0,o.mdx)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h2",{id:"introduction"},"Introduction"),(0,o.mdx)("p",null,"In Litho we perform UI updates by changing state or props on the component tree instead of mutating the views directly. In a similar way, the animation framework adds transitions to components that are triggered when regenerating a tree. It is important to avoid accessing the underlying view to add animations as these values will probably not be preserved."),(0,o.mdx)("p",null,"Transitions can be used to animate view properties when they change between layouts, i.e. due to a state update or new props from the parent. In the following example we will create a layout with a simple state change triggered by a click. We will then demonstraight the different ways of applying transitions animations."),(0,o.mdx)("p",null,"When we make changes to a tree due to a new state, these changes happen immediately. Let's imagine that we have a simple Component that renders a yellow square, and aligns it to either the right or left edge of screen based on value of the ",(0,o.mdx)("inlineCode",{parentName:"p"},"@State boolean toRight"),"."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-java",metastring:"file=sample/src/main/java/com/facebook/samples/litho/java/animations/docs/SimpleAllLayoutTransitionComponentSpec.java start=start end=no_animation",file:"sample/src/main/java/com/facebook/samples/litho/java/animations/docs/SimpleAllLayoutTransitionComponentSpec.java",start:"start",end:"no_animation"},"@LayoutSpec\npublic class SimpleAllLayoutTransitionComponentSpec {\n\n  @OnCreateLayout\n  static Component onCreateLayout(ComponentContext c, @State boolean toRight) {\n    return Column.create(c)\n        .clickHandler(SimpleAllLayoutTransitionComponent.onClickEvent(c))\n        .child(SolidColor.create(c).color(YELLOW).widthDip(80).heightDip(80))\n        .alignItems(toRight ? YogaAlign.FLEX_END : YogaAlign.FLEX_START)\n        .build();\n  }\n\n  @OnEvent(ClickEvent.class)\n  static void onClickEvent(ComponentContext c, @FromEvent View view) {\n    SimpleAllLayoutTransitionComponent.onUpdateState(c);\n  }\n\n  @OnUpdateState\n  static void onUpdateState(StateValue<Boolean> toRight) {\n    toRight.set(!toRight.get());\n  }\n")),(0,o.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px"},(0,o.mdx)("source",{type:"video/webm",src:(0,r.default)("/videos/transitions/basics1.webm")}),(0,o.mdx)("p",null,"Your browser does not support the video element.")),(0,o.mdx)("p",null,"When the value of the state changes we re-render the ",(0,o.mdx)("inlineCode",{parentName:"p"},"ComponentTree"),' which makes the square appear to \u201cjump\u201d from its previous position to the new one. In the next stem we will show how to replace this "jump" with a transition animation.'),(0,o.mdx)("h3",{id:"bounds-transitions"},"Bounds Transitions"),(0,o.mdx)("p",null,"There is a simple way to add bounds animations to all transitioning components between tree changes. Add the following:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-java",metastring:"file=sample/src/main/java/com/facebook/samples/litho/java/animations/docs/SimpleAllLayoutTransitionComponentSpec.java start=no_animation end=end",file:"sample/src/main/java/com/facebook/samples/litho/java/animations/docs/SimpleAllLayoutTransitionComponentSpec.java",start:"no_animation",end:"end"},"@OnCreateTransition\nstatic Transition onCreateTransition(ComponentContext c) {\n  return Transition.allLayout();\n}\n")),(0,o.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px"},(0,o.mdx)("source",{type:"video/webm",src:(0,r.default)("/videos/transitions/basics2.webm")}),(0,o.mdx)("p",null,"Your browser does not support the video element.")),(0,o.mdx)("p",null,"Returning ",(0,o.mdx)("a",{parentName:"p",href:"https://staticdocs.thefacebook.com/litho/javadoc/com/facebook/litho/Transition.html#allLayout--"},(0,o.mdx)("inlineCode",{parentName:"a"},"Transition.allLayout()"))," will create a Transition that will automatically animate any changes to position or width and height."),(0,o.mdx)("p",null,"This only works when changing the bounds of a component and will not work with:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},"Other properties including scale, alpha and rotation."),(0,o.mdx)("li",{parentName:"ul"},"Components that are being added or removed.")),(0,o.mdx)("h3",{id:"transitions"},"Transitions"),(0,o.mdx)("p",null,"Once we move out of just bounds and instead of animating the ",(0,o.mdx)("inlineCode",{parentName:"p"},"X")," we want to animate ",(0,o.mdx)("inlineCode",{parentName:"p"},"ALPHA")," there are just a couple of things you need to add to your code to make it happen."),(0,o.mdx)("p",null,"For more control over the transitions we can use these apis:"),(0,o.mdx)("ul",null,(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"strong"},"@OnCreateTransition"))," method. You need to add a method annotated with ",(0,o.mdx)("inlineCode",{parentName:"li"},"@OnCreateTransition")," to your Spec, which is what we use to define the transition animations. It should return a ",(0,o.mdx)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/Transition.html"},(0,o.mdx)("inlineCode",{parentName:"a"},"Transition")),", and its first argument should always be of ",(0,o.mdx)("inlineCode",{parentName:"li"},"ComponentContext")," type. As other lifecycle methods in a Spec, it could also have ",(0,o.mdx)("inlineCode",{parentName:"li"},"@Prop")," arguments, as well as arguments of ",(0,o.mdx)("inlineCode",{parentName:"li"},"StateValue")," type, although this comes at a cost - more on this later."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"strong"},"Transition"))," is a description of which Component/Property (mandatory) and how (optional) you want to animate. You will not use a constructor to create ",(0,o.mdx)("inlineCode",{parentName:"li"},"Transition")," instances, instead you will use one of the provided ",(0,o.mdx)("inlineCode",{parentName:"li"},"Builder"),"s."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"strong"},"transitionKey"))," is an identifier that you normally assign to a ",(0,o.mdx)("inlineCode",{parentName:"li"},"Component")," that you want to animate, and then use it when defining ",(0,o.mdx)("inlineCode",{parentName:"li"},"Transition"),"."),(0,o.mdx)("li",{parentName:"ul"},(0,o.mdx)("strong",{parentName:"li"},(0,o.mdx)("inlineCode",{parentName:"strong"},"AnimatedProperties"))," are used to target the property of a ",(0,o.mdx)("inlineCode",{parentName:"li"},"Component")," that should be animated when its value changes.")),(0,o.mdx)("p",null,"To put it all together, here is what it would look like in our case:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-java",metastring:"file=sample/src/main/java/com/facebook/samples/litho/java/animations/docs/AlphaTransitionComponentSpec.java start=start end=end",file:"sample/src/main/java/com/facebook/samples/litho/java/animations/docs/AlphaTransitionComponentSpec.java",start:"start",end:"end"},'@LayoutSpec\npublic class AlphaTransitionComponentSpec {\n\n  private static final String SQUARE_KEY = "square";\n\n  @OnCreateLayout\n  static Component onCreateLayout(ComponentContext c, @State boolean isHalfAlpha) {\n    return Column.create(c)\n        .clickHandler(AlphaTransitionComponent.onClickEvent(c))\n        .child(\n            Row.create(c)\n                .backgroundColor(YELLOW)\n                .widthDip(80)\n                .heightDip(80)\n                .alpha(isHalfAlpha ? 0.5f : 1.0f)\n                .transitionKey(SQUARE_KEY))\n        .build();\n  }\n\n  @OnCreateTransition\n  static Transition onCreateTransition(ComponentContext c) {\n    return Transition.create(SQUARE_KEY).animate(AnimatedProperties.ALPHA);\n  }\n\n  @OnEvent(ClickEvent.class)\n  static void onClickEvent(ComponentContext c, @FromEvent View view) {\n    AlphaTransitionComponent.onUpdateState(c);\n  }\n\n  @OnUpdateState\n  static void onUpdateState(StateValue<Boolean> isHalfAlpha) {\n    isHalfAlpha.set(!isHalfAlpha.get());\n  }\n}\n')),(0,o.mdx)("video",{loop:"true",autoplay:"true",class:"video",width:"100%",height:"500px"},(0,o.mdx)("source",{type:"video/webm",src:(0,r.default)("/videos/transitions/basics3.webm")}),(0,o.mdx)("p",null,"Your browser does not support the video element.")),(0,o.mdx)("p",null,"Notice that we:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"On ",(0,o.mdx)("em",{parentName:"li"},"line 16")," we assign a ",(0,o.mdx)("inlineCode",{parentName:"li"},"transitionKey")," to the ",(0,o.mdx)("inlineCode",{parentName:"li"},"SolidColor")," component using ",(0,o.mdx)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/Component.Builder.html#transitionKey-java.lang.String-"},(0,o.mdx)("inlineCode",{parentName:"a"},"Component.Builder#transitionKey()"))," method."),(0,o.mdx)("li",{parentName:"ol"},"On ",(0,o.mdx)("em",{parentName:"li"},"lines 22-23")," we create a ",(0,o.mdx)("inlineCode",{parentName:"li"},"Transition")," using ",(0,o.mdx)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/Transition.html#create-java.lang.String-"},(0,o.mdx)("inlineCode",{parentName:"a"},"Transition.create()"))," that takes a ",(0,o.mdx)("inlineCode",{parentName:"li"},"transitionKey")," and then specify the property of the component using ",(0,o.mdx)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/Transition.TransitionUnitsBuilder.html#animate-com.facebook.litho.animation.AnimatedProperty-"},(0,o.mdx)("inlineCode",{parentName:"a"},".animate()"))," method that takes an ",(0,o.mdx)("a",{parentName:"li",href:"pathname:///javadoc/com/facebook/litho/animation/AnimatedProperties.html"},(0,o.mdx)("inlineCode",{parentName:"a"},"AnimatedProperty")),".")),(0,o.mdx)("p",null,"Both of these methods take a ",(0,o.mdx)("a",{parentName:"p",href:"pathname:///javadoc/com/facebook/litho/Transition.html#create-java.lang.String...-"},"variable number of arguments"),", so multiple ",(0,o.mdx)("inlineCode",{parentName:"p"},"Transition"),"s may be expressed like:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-java"},'private static final String SQUARE_KEY = "square";\nprivate static final String OVAL_KEY = "oval";\nprivate static final String ANOTHER_SHAPE = "another_shape";\n\n...\n\n@OnCreateTransition\nstatic Transition onCreateTransition(ComponentContext c) {\n    return Transition.create(SQUARE_KEY, OVAL_KEY, ANOTHER_SHAPE)\n        .animate(AnimatedProperties.X, AnimatedProperties.Y);\n}\n')),(0,o.mdx)("p",null,"The transitions animations API supports three ",(0,o.mdx)("a",{parentName:"p",href:"/docs/animations/transition-types"},"types of transitions"),", ",(0,o.mdx)("strong",{parentName:"p"},"change"),", ",(0,o.mdx)("strong",{parentName:"p"},"appear")," and ",(0,o.mdx)("strong",{parentName:"p"},"disappear")," which work differently depending on how the tree changes between states. In this example we did a ",(0,o.mdx)("strong",{parentName:"p"},"change")," transition."))}u.isMDXComponent=!0}}]);