"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7158],{3905:(e,n,t)=>{t.r(n),t.d(n,{MDXContext:()=>c,MDXProvider:()=>p,mdx:()=>x,useMDXComponents:()=>m,withMDXComponents:()=>s});var i=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function d(e,n){if(null==e)return{};var t,i,o=function(e,n){if(null==e)return{};var t,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=i.createContext({}),s=function(e){return function(n){var t=m(n.components);return i.createElement(e,a({},n,{components:t}))}},m=function(e){var n=i.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},p=function(e){var n=m(e.components);return i.createElement(c.Provider,{value:n},e.children)},h={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},u=i.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,r=e.parentName,c=d(e,["components","mdxType","originalType","parentName"]),s=m(t),p=o,u=s["".concat(r,".").concat(p)]||s[p]||h[p]||a;return t?i.createElement(u,l(l({ref:n},c),{},{components:t})):i.createElement(u,l({ref:n},c))}));function x(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,r=new Array(a);r[0]=u;var l={};for(var d in n)hasOwnProperty.call(n,d)&&(l[d]=n[d]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var c=2;c<a;c++)r[c]=t[c];return i.createElement.apply(null,r)}return i.createElement.apply(null,t)}u.displayName="MDXCreateElement"},30535:(e,n,t)=>{t.r(n),t.d(n,{frontMatter:()=>r,contentTitle:()=>l,metadata:()=>d,toc:()=>c,default:()=>m});var i=t(87462),o=t(63366),a=(t(67294),t(3905)),r={id:"communicating-with-the-ui",title:"Scrolling and communicating with the UI"},l=void 0,d={unversionedId:"communicating-with-the-ui",id:"communicating-with-the-ui",isDocsHomePage:!1,title:"Scrolling and communicating with the UI",description:"Introduction",source:"@site/../docs/communicating-with-the-ui.md",sourceDirName:".",slug:"/communicating-with-the-ui",permalink:"/docs/communicating-with-the-ui",editUrl:"https://github.com/facebook/litho/edit/master/website/../docs/communicating-with-the-ui.md",version:"current",frontMatter:{id:"communicating-with-the-ui",title:"Scrolling and communicating with the UI"}},c=[{value:"Introduction",id:"introduction",children:[]},{value:"@OnRefresh",id:"onrefresh",children:[{value:"API",id:"api",children:[]}]},{value:"@OnViewportChanged",id:"onviewportchanged",children:[{value:"API",id:"api-1",children:[]},{value:"Change in Viewport",id:"change-in-viewport",children:[]},{value:"Positions and Counts",id:"positions-and-counts",children:[]}]},{value:"@OnDataBound",id:"ondatabound",children:[]},{value:"Scrolling: requestFocus()",id:"scrolling-requestfocus",children:[{value:"API",id:"api-2",children:[]}]},{value:"@OnEvent(LoadingEvent.class)",id:"oneventloadingeventclass",children:[{value:"API",id:"api-3",children:[]},{value:"Dispatch up the hierarchy",id:"dispatch-up-the-hierarchy",children:[]}]}],s={toc:c};function m(e){var n=e.components,t=(0,o.Z)(e,["components"]);return(0,a.mdx)("wrapper",(0,i.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,a.mdx)("h2",{id:"introduction"},"Introduction"),(0,a.mdx)("p",null,"Data flows through the section hierarchy before they are eventually represented on the UI by components.\nSection provides a set of functionalities to allow you to respond to the data and interact with the UI."),(0,a.mdx)("h2",{id:"onrefresh"},"@OnRefresh"),(0,a.mdx)("p",null,"A method annotated with this annotation will be called when the the UI rendered by the\nsection's hierarchy is requesting for a refresh of the content."),(0,a.mdx)("h3",{id:"api"},"API"),(0,a.mdx)("p",null,"Call ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionTree#refresh()")," to propagate your refresh request to all the sections in the hierarchy. Then you can handle it in your section like this:"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-java"},"class SectionSpec {\n\n  @OnRefresh\n  static void onRefresh(SectionContext c, @Prop yourProp, @State yourState) {\n    // Handle your refresh request\n  }\n}\n")),(0,a.mdx)("h2",{id:"onviewportchanged"},"@OnViewportChanged"),(0,a.mdx)("p",null,"A method annotated with this annotation will be called when there is a change in the visible viewport."),(0,a.mdx)("h3",{id:"api-1"},"API"),(0,a.mdx)("p",null,"Call ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionTree#viewPortChanged()")," or ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionTree#viewPortChangedFromScrolling()")," to allow your sections to know that something on the viewport is now different."),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-java"},"class SectionSpec {\n\n  @OnViewportChanged\n  static void onViewportChanged(\n    SectionContext c,\n    int firstVisiblePosition,\n    int lastVisiblePosition,\n    int totalCount,\n    int firstFullyVisibleIndex,\n    int lastFullyVisibleIndex,\n    @Prop YourProp prop,\n    @State YourState state) {\n  }\n}\n")),(0,a.mdx)("ol",null,(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"firstVisiblePosition"),"\nPosition of the first visible components in the viewport. Components are partially\nhidden from the visible viewport.")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"lastVisiblePosition"),"\nPosition of the last visible components in the viewport. Components are partially\nhidden from the visible viewport.")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"totalCount"),"\nTotal number of items in the section's hierarchy, with the section that contains the\nannotated method as its root.")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"firstFullyVisibleIndex"),"\nPosition of the first fully visible components in the viewport.")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"lastFullyVisibleIndex"),"\nPosition of the last fully visible components in the viewport."))),(0,a.mdx)("h3",{id:"change-in-viewport"},"Change in Viewport"),(0,a.mdx)("p",null,"A viewport change could occur due to any number of the following reasons:"),(0,a.mdx)("ol",null,(0,a.mdx)("li",{parentName:"ol"},"Components added to the visible viewport."),(0,a.mdx)("li",{parentName:"ol"},"Components removed from the visible viewport."),(0,a.mdx)("li",{parentName:"ol"},"Scrolling."),(0,a.mdx)("li",{parentName:"ol"},"Components in the visible viewport are updated."),(0,a.mdx)("li",{parentName:"ol"},"Components have moved in or out of the visible viewport.")),(0,a.mdx)("h3",{id:"positions-and-counts"},"Positions and Counts"),(0,a.mdx)("p",null,"Positions and total count returned are with respect to the number of components this section has.\nFor example:"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre"},"       Section A\n      /         \\\n Section B   Section C\n    |           |\n  10 items    10 items\n  (visible)   (hidden)\n")),(0,a.mdx)("p",null," When the first item of Section C comes into the viewport due to scrolling, ",(0,a.mdx)("inlineCode",{parentName:"p"},"firstVisiblePosition")," of ",(0,a.mdx)("inlineCode",{parentName:"p"},"Section C")," is 0 while the ",(0,a.mdx)("inlineCode",{parentName:"p"},"lastVisiblePosition")," of ",(0,a.mdx)("inlineCode",{parentName:"p"},"Section B")," is 10."),(0,a.mdx)("p",null," Section A has a total of 20 items while Section B and C have 10 each."),(0,a.mdx)("h2",{id:"ondatabound"},"@OnDataBound"),(0,a.mdx)("p",null,"A method annotated with this annotation will be called when the data changes corresponding to this\nsection's hierarchy is made available to the ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionTree.Target"),"."),(0,a.mdx)("p",null,"Data changes could occur due to any number of the following:"),(0,a.mdx)("ol",null,(0,a.mdx)("li",{parentName:"ol"},"Insertion"),(0,a.mdx)("li",{parentName:"ol"},"Update"),(0,a.mdx)("li",{parentName:"ol"},"Delete"),(0,a.mdx)("li",{parentName:"ol"},"Move")),(0,a.mdx)("p",null,"Availability of these data changes do not mean they are visible on the viewport.\nTo detect visibility, use ",(0,a.mdx)("inlineCode",{parentName:"p"},"@OnViewportChanged"),"."),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-java"},"class SectionSpec {\n\n  @OnDataBound\n  static void OnDataBound(\n    SectionContext c,\n    @Prop YourProp prop\n    @State YourState state) {\n    // Handle data changes\n  }\n}\n")),(0,a.mdx)("h2",{id:"scrolling-requestfocus"},"Scrolling: requestFocus()"),(0,a.mdx)("p",null,"Use this method to give focus to one of the components in a section. If the component is hidden from the visible viewport, the section will be scrolled to reveal it, thereby calling the ",(0,a.mdx)("inlineCode",{parentName:"p"},"@OnViewportChanged")," annotated method."),(0,a.mdx)("p",null,"The data that renders the component being requested for focus has to be available before the method can work. Hence, only use ",(0,a.mdx)("inlineCode",{parentName:"p"},"requestFocus()")," after the ",(0,a.mdx)("inlineCode",{parentName:"p"},"@OnDataBound")," annotated method has been called."),(0,a.mdx)("h3",{id:"api-2"},"API"),(0,a.mdx)("p",null,"There a few variations of the ",(0,a.mdx)("inlineCode",{parentName:"p"},"requestFocus()")," method."),(0,a.mdx)("h4",{id:"sectionlifecyclerequestfocussectioncontext-c-int-index"},"SectionLifecycle.requestFocus(SectionContext c, int index)"),(0,a.mdx)("p",null,"Calls focus by the index of the ",(0,a.mdx)("inlineCode",{parentName:"p"},"Component")," in the ",(0,a.mdx)("inlineCode",{parentName:"p"},"Section")," scoped by the given ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionContext")),(0,a.mdx)("div",{className:"admonition admonition-info alert alert--info"},(0,a.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,a.mdx)("h5",{parentName:"div"},(0,a.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,a.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,a.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,a.mdx)("div",{parentName:"div",className:"admonition-content"},(0,a.mdx)("p",{parentName:"div"},"As with ",(0,a.mdx)("inlineCode",{parentName:"p"},"@OnViewportChanged"),", the index is with respect to the number of components this section has."))),(0,a.mdx)("h4",{id:"sectionlifecyclerequestfocussectioncontext-c-string-sectionkey"},"SectionLifecycle.requestFocus(SectionContext c, String sectionKey)"),(0,a.mdx)("p",null,"Calls focus to the first index of the component in the section represented by the section's key you provided."),(0,a.mdx)("h4",{id:"sectionlifecyclerequestfocuswithoffsetsectioncontext-c-int-index-int-offset"},"SectionLifecycle.requestFocusWithOffset(SectionContext c, int index, int offset)"),(0,a.mdx)("p",null,"Same as ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionLifecycle.requestFocus(SectionContext c, int index)")," but with an offset."),(0,a.mdx)("h4",{id:"sectionlifecyclerequestfocuswithoffsetsectioncontext-c-string-sectionkey-int-offset"},"SectionLifecycle.requestFocusWithOffset(SectionContext c, String sectionKey, int offset)"),(0,a.mdx)("p",null,"Same as ",(0,a.mdx)("inlineCode",{parentName:"p"},"SectionLifecycle.requestFocus(SectionContext c, String sectionKey)")," but with an offset."),(0,a.mdx)("h4",{id:"sectionlifecyclerequestfocussectioncontext-c-string-sectionkey-focustype-focustype"},"SectionLifecycle.requestFocus(SectionContext c, String sectionKey, FocusType focusType)"),(0,a.mdx)("p",null,(0,a.mdx)("inlineCode",{parentName:"p"},"FocusType")," is either:"),(0,a.mdx)("ol",null,(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"FocusType.START"),"\nCalls focus to the first index of the component in the section")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"FocusType.END"),"\nCalls focus to the last index of the component in the section"))),(0,a.mdx)("h4",{id:"sectionlifecyclerequestsmoothfocussectioncontext-c-int-index-smoothscrollalignmenttype-type"},"SectionLifecycle.requestSmoothFocus(SectionContext c, int index, SmoothScrollAlignmentType type)"),(0,a.mdx)("p",null,"Use this variation if you need to specify a snapping mode.\n",(0,a.mdx)("inlineCode",{parentName:"p"},"SmoothScrollAlignmentType")," is either:"),(0,a.mdx)("ol",null,(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("inlineCode",{parentName:"li"},"SNAP_TO_ANY")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("inlineCode",{parentName:"li"},"SNAP_TO_START")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("inlineCode",{parentName:"li"},"SNAP_TO_END")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("inlineCode",{parentName:"li"},"SNAP_TO_CENTER"))),(0,a.mdx)("p",null,"For the full list of methods available to request scroll to a position, check out the ",(0,a.mdx)("a",{parentName:"p",href:"pathname:///javadoc/com/facebook/litho/sections/SectionLifecycle.html"},"SectionLifecycle")," documentation."),(0,a.mdx)("h2",{id:"oneventloadingeventclass"},"@OnEvent(LoadingEvent.class)"),(0,a.mdx)("p",null,"Sections should use this annotation to declare a method to receive events about its children loading\nstate."),(0,a.mdx)("h3",{id:"api-3"},"API"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-java"},"class YourSectionSpec {\n\n  @OnCreateChildren\n  protected static Children onCreateChildren(SectionContext c) {\n    return Children.create()\n        .child(\n          ChildSection\n            .create(c)\n            .loadingEventHandler(YourSection.onLoadingEvent(c)))\n        .build()\n    }\n  }\n\n  @OnEvent(LoadingEvent.class)\n  static void onLoadingEvent(\n    SectionContext c,\n    @FromEvent LoadingState loadingState,\n    @FromEvent boolean isEmpty,\n    @FromEvent Throwable t) {\n\n    switch (loadingState) {\n        case INITIAL_LOAD:\n        case LOADING:\n          // Handle loading\n          break;\n        case FAILED:\n          // Handle failure\n          break;\n        case SUCCEEDED:\n          // Handle success\n          break;\n    }\n\n    // Dispatch the same loading event up the hierarchy.\n    SectionLifecycle.dispatchLoadingEvent(\n        c,\n        isEmpty,\n        loadingState,\n        t);\n  }\n}\n")),(0,a.mdx)("h4",{id:"loadingstate-loadingstate"},"LoadingState loadingState"),(0,a.mdx)("ol",null,(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"INITIAL_LOAD"),"\nLoading has started")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"LOADING"),"\nLoading is still ongoing")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"SUCCEEDED"),"\nLoading is successful")),(0,a.mdx)("li",{parentName:"ol"},(0,a.mdx)("p",{parentName:"li"},(0,a.mdx)("inlineCode",{parentName:"p"},"FAILED"),"\nLoading has failed."))),(0,a.mdx)("h4",{id:"boolean-isempty"},"boolean isEmpty"),(0,a.mdx)("p",null,"Returns true if the data set is empty after the loading event"),(0,a.mdx)("h4",{id:"throwable-t"},"Throwable t"),(0,a.mdx)("p",null,"Returns the reason for a ",(0,a.mdx)("inlineCode",{parentName:"p"},"LOAD_FAILED")," event"),(0,a.mdx)("h3",{id:"dispatch-up-the-hierarchy"},"Dispatch up the hierarchy"),(0,a.mdx)("p",null,"The loading event will be passed up the hierarchy until there is a section that has chosen to handle\nit. If your section handles the loading event, it has to dispatch the event up its hierarchy if\nthere are parent sections looking to handle it as well."),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre",className:"language-java"},"SectionLifecycle.dispatchLoadingEvent(c, isEmpty, loadingState, t);\n")))}m.isMDXComponent=!0}}]);