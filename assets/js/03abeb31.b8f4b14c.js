"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[1660],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>s,MDXProvider:()=>d,mdx:()=>h,useMDXComponents:()=>p,withMDXComponents:()=>c});var r=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){return function(t){var n=p(t.components);return r.createElement(e,a({},t,{components:n}))}},p=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(s.Provider,{value:t},e.children)},g={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,s=u(e,["components","mdxType","originalType","parentName"]),c=p(n),d=o,m=c["".concat(i,".").concat(d)]||c[d]||g[d]||a;return n?r.createElement(m,l(l({ref:t},s),{},{components:n})):r.createElement(m,l({ref:t},s))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var u in t)hasOwnProperty.call(t,u)&&(l[u]=t[u]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var s=2;s<a;s++)i[s]=n[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},54922:(e,t,n)=>{n.r(t),n.d(t,{frontMatter:()=>i,contentTitle:()=>l,metadata:()=>u,toc:()=>s,default:()=>p});var r=n(87462),o=n(63366),a=(n(67294),n(3905)),i={id:"debugging",title:"Debugging"},l=void 0,u={unversionedId:"debugging",id:"debugging",isDocsHomePage:!1,title:"Debugging",description:"Annotation Processor",source:"@site/../docs/debugging.md",sourceDirName:".",slug:"/debugging",permalink:"/docs/debugging",editUrl:"https://github.com/facebook/litho/edit/master/website/../docs/debugging.md",version:"current",frontMatter:{id:"debugging",title:"Debugging"}},s=[{value:"Annotation Processor",id:"annotation-processor",children:[]}],c={toc:s};function p(e){var t=e.components,i=(0,o.Z)(e,["components"]);return(0,a.mdx)("wrapper",(0,r.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,a.mdx)("h2",{id:"annotation-processor"},"Annotation Processor"),(0,a.mdx)("p",null,(0,a.mdx)("strong",{parentName:"p"},"With Gradle")),(0,a.mdx)("p",null,"Debugging the annotation processor stage is a bit tricky as you are essentially debugging the Java Compiler (",(0,a.mdx)("inlineCode",{parentName:"p"},"javac"),").\nGradle, however, allows you to attach a debugger during the compilation stage by setting the property ",(0,a.mdx)("inlineCode",{parentName:"p"},"org.gradle.debug")," to true.\nTo start Gradle with that flag, figure out a target that invokes the annotation processor and start it like this:"),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre"},"./gradlew --no-daemon -Dorg.gradle.debug=true :litho-widget:compileDebugJavaWithJavac\n")),(0,a.mdx)("p",null,"In this case we are compiling the ",(0,a.mdx)("inlineCode",{parentName:"p"},"litho-widget")," package."),(0,a.mdx)("p",null,'This will pause the execution during the "Starting Daemon" phase until you connect your debugger. This can be done by\nrunning a standard "Remote" target in IntelliJ which will look like this:'),(0,a.mdx)("p",null,(0,a.mdx)("img",{alt:"IntelliJ Remote Target",src:n(41401).Z})),(0,a.mdx)("p",null,"Now set a breakpoint at the right point, run your remote target and debug away!"),(0,a.mdx)("p",null,(0,a.mdx)("strong",{parentName:"p"},"With Buck")),(0,a.mdx)("p",null,"Buck doesn't have built-in support for suspending the compiler, but you can still attach a debugger by directly\ninstrumenting the JVM to open a debugging port."),(0,a.mdx)("p",null,"For that, first make sure to kill any previous instances of Buck which may still be running with old flags, then\nset the ",(0,a.mdx)("inlineCode",{parentName:"p"},"JAVA_TOOLS_OPTIONS")," to contain the JDWP options. Exporting the variable\nmake sure that this is also picked up by child processes spawned by buck.\nLimiting the number of threads will dramatically speed up the interactive\ndebugging performance as you won't have to wait for the scheduler to come around\nagain and hand you a time slice."),(0,a.mdx)("pre",null,(0,a.mdx)("code",{parentName:"pre"},'$ buck kill\n$ export JAVA_TOOL_OPTIONS="-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005"\n$ buck build --num-threads 1 //litho-widget/...\n')),(0,a.mdx)("p",null,"Note that this won't pause the JVM (",(0,a.mdx)("inlineCode",{parentName:"p"},"suspend=n"),"), but as the process will continue to run you can choose to\nattach to the process at any time."))}p.isMDXComponent=!0},41401:(e,t,n)=>{n.d(t,{Z:()=>r});const r=n.p+"assets/images/remote-debugger-f547490a68de214c0d1896145fd31b95.png"}}]);